/*!
 * @name jQuery Tuenti API 1.0.0
 * @autor yeikos
 
 * @dependencies: jQuery, JSON2
 
 * Copyright 2011 - https://github.com/yeikos/nodejs.tuenti
 * GNU General Public License
 * http://www.gnu.org/licenses/gpl-3.0.txt
 */
 
;(function($, undefined) {

	function Request(session) {

		var self = this;
		
		this.session = session;

		this.main = function(action, data, callback) {

			var type = typeof data;
			
			if (type != 'object') {
			
				if (type == 'function') {
				
					callback = data;
					
				}
				
				data = {};
				
			}
		
			data.session_id = self.session;
		
			$.tuenti.request(action, data, callback);
			
		};

	}
	
	$.tuenti = {
	
		host: '/tuenti',
		
		login: function(email, password, callback) {
		
			$.getJSON($.tuenti.host, { action: 'login', email: email, password: password }, function(response) {
			
				if (typeof callback == 'function') {
				
					var request = new Request(response.session_id);
	
					callback(request.main, response, request.session);
	
				}
				
			});
			
		},
		
		request: function(method, data, callback) {
				
			$.getJSON($.tuenti.host, { action: 'request', method: method, data: JSON.stringify(data) }, function(response) {
			
				if (typeof callback == 'function') {
				
					callback(response);
					
				};
				
			});

		}
		
	};

})(jQuery);